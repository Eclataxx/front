<template>
  <div class="carousel place-content-center bg-gray-300 h-full">
    <transition name="component-fade" mode="out-in">
        <img
            :alt="currentItem.alt"
            :src="currentItem.imgSrc"
            width="400" height="150"
            class="flex justify-between mx-auto pb-2 transition duration-500 ease-in-out"
            @click="$router.push(currentItem.to)"
        />
    </transition>

    <div class="flex justify-between w-24 mx-auto">
      <button
        v-for="(_, index) of items"
        :key="`goto-${index}`"
        @click="goToItem(index)"
        class="rounded-full w-4 pb-2 transition duration-500 ease-in-out"
        :class="{
            'bg-gray-900': index === currentIndex,
            'bg-gray-400': index !== currentIndex,
            }"
      ></button>
    </div>
  </div>
</template>

<script lang="ts">
import { Options, Vue } from 'vue-class-component';
import { ItemModel } from '../models/carousel/item.model';

export default class Carousel extends Vue {
  currentIndex: number = 0;

  interval: number = 0;

  items: ItemModel[] = [
    {
      alt: 'Broken Ipad',
      imgSrc: '/images/ipad.jpg',
      to: '/product',
    },
    {
      alt: 'Broken Imac',
      imgSrc: '/images/imac.jpg',
      to: '/product',
    },
  ]

  mounted() {
    this.interval = setInterval(() => this.next(), 5 * 1000);
  }

  get currentItem() {
    return this.items[this.currentIndex];
  }

  public next() {
    clearInterval(this.interval);
    this.currentIndex = (this.currentIndex + 1) % this.items.length;
    this.interval = setInterval(() => this.next(), 5 * 1000);
  }

  public prev() {
    clearInterval(this.interval);
    this.interval = setInterval(() => this.next(), 5 * 1000);
    this.currentIndex = (this.currentIndex ? this.currentIndex : this.items.length) - 1;
  }

  public goToItem(n: number) {
    clearInterval(this.interval);
    this.currentIndex = n;
    this.interval = setInterval(() => this.next(), 5 * 1000);
  }
}
</script>
